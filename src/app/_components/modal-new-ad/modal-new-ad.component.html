<div class="modal-header bg-dark-modal text-white">
  <h5 class="modal-title" id="exampleModalLabel">Nuevo Anuncio</h5>
  <a class="hover-shadow text-light" role="button">
    <i class=" fas fa-times fa-2x" (click)="modalRef.close()" aria-label="Cerrar"></i>
  </a>
</div>

<div class="modal-body bg-dark-modal">
  <mat-horizontal-stepper linear>
    <mat-step [stepControl]="fileForm" label="Sube el archivo" state="file">
      <form [formGroup]="fileForm">

        <!-- Label con popover -->
        <label for="upload" class="text-white my-2">
          Contenido del anuncio
          <button
            type="button"
            class="btn btn-warning btn-floating little me-2"
            placement="right"
            mdbPopover="Imágenes (jpg, jpeg, png)<br>
                        GIFs (gif)<br>
                        Vídeos (mp4, avi, webm)"
            [template]="true"
            mdbPopoverTitle="Tipos permitidos"
            trigger="hover">
            <i class="fas fa-question"></i>
          </button>
        </label>

        <!-- Input -->
        <div class="input-group">
          <input accept="image/jpeg,image/png,image/gif,video/mp4,video/avi,video/webm" hidden
                 type="file" class="form-control" id="recurso" (change)="uploadFile($event)" formControlName="recurso"/>

          <input type="text" class="form-control hover-pointer" placeholder="Sin archivos seleccionados"
                 aria-label="Subida del recurso de su anuncio" aria-describedby="upload" (click)="clickUpload()"/>
          <button class="btn btn-outline-white" type="button" id="upload" (click)="clickUpload()">
            Subir Fichero
          </button>
        </div>

        <div class="form-text">
          Tenga en cuenta que si es un vídeo no debe superar los 30 s de duración
        </div>

        <!-- Errores input -->
        <div *ngIf="fileForm.get('recurso')?.touched && fileForm.get('recurso')?.errors" class="mt-1">
          <div class="error" *ngIf="fileForm.get('recurso')?.errors?.required">
            Es obligatorio subir un archivo
          </div>
          <div class="error" id="recurso-error" *ngIf="fileForm.get('recurso')?.errors?.formServer"></div>
        </div>

        <!-- Step siguiente -->
        <div class="d-flex justify-content-end">
          <button class="btn btn-link" matStepperNext (click)="checkValidity($event)"
                  *ngIf="!loading; else spinner">Siguiente</button>
          <ng-template class="spinner-border white-text hover-pointer" role="status" #spinner>
            <span class="visually-hidden">Procesando...</span>
          </ng-template>
        </div>
      </form>
    </mat-step>
    <mat-step [stepControl]="detailsForm" label="Selecciona los detalles" state="details">

      <form [formGroup]="detailsForm">


        <div class="d-flex justify-content-end">
          <button class="btn btn-link" matStepperPrevious *ngIf="!loading; else spinner">Atrás</button>
          <button class="btn btn-link" matStepperNext *ngIf="!loading; else spinner">Siguiente</button>
          <ng-template class="spinner-border white-text hover-pointer" role="status" #spinner>
            <span class="visually-hidden">Procesando...</span>
          </ng-template>
        </div>
      </form>

    </mat-step>
    <mat-step [stepControl]="doneForm" label="Todo listo" state="last">

      <form [formGroup]="doneForm">


        <div class="d-flex justify-content-end">
          <button class="btn btn-link" matStepperPrevious>Atrás</button>
          <button class="btn btn-link" matStepperNext>Terminar</button>
        </div>

        <div class="d-flex justify-content-end">
          <button class="btn btn-link" matStepperPrevious>Atrás</button>
          <button class="btn btn-link" *ngIf="finished; else spinner">Terminar</button>
          <ng-template class="spinner-border white-text hover-pointer" role="status" #spinner>
            <span class="visually-hidden">Procesando...</span>
          </ng-template>
        </div>
      </form>

    </mat-step>

    <!-- Icon overrides. -->
    <ng-template matStepperIcon="edit" let-index="index">
      <mat-icon *ngIf="index === 0">attach_file</mat-icon>
      <mat-icon *ngIf="index === 1">notes</mat-icon>
      <mat-icon *ngIf="index === 2">done_all</mat-icon>
    </ng-template>

    <ng-template matStepperIcon="file">
      <mat-icon>attach_file</mat-icon>
    </ng-template>

    <ng-template matStepperIcon="details">
      <mat-icon>notes</mat-icon>
    </ng-template>

    <ng-template matStepperIcon="last">
      <mat-icon>done_all</mat-icon>
    </ng-template>
  </mat-horizontal-stepper>
</div>

